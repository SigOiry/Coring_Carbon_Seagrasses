---
title: "Where to perform the coring in each sites ?"
editor_options: 
  chunk_output_type: console
---

<div style="text-align: center; margin-top: 20px;">
  <button onclick="window.open('https://github.com/SigOiry/Coring_Carbon_Seagrasses', '_blank');" 
          style="padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
    Visit the Github repository
  </button>
</div>

This website gathers all the processing steps used to identify the densest, most recent, and most consistent seagrass patches across different sites, in order to plan future coring strategies.

It gathers analysis done on two sites, Cadiz Bay in Spain ain a nd Bourgneuf Bay in France.

```{r leafletmap}
#| fig-cap: Map of study sites, where coring will be perform in the frame of the Rewrite Project. 
#| echo: false
#| error: false
#| message: false
#| warning: false
#| out-width: "95%"

library(leaflet)
library(htmlwidgets)
library(jsonlite)


coords <- data.frame(
  name  = c("Bourgneuf Bay, France", "Cádiz Bay, Spain"),
  lat   = c(47.11667, 36.53333),
  lng   = c(-2.15000,  -6.30000),
  label = c("Bourgneuf Bay",    "Cádiz Bay"),
  url     = c("https://fr.wikipedia.org/wiki/Baie_de_Bourgneuf",
              "https://en.wikipedia.org/wiki/Bay_of_Cádiz"),
  xOffset = c(0,  0),    
  yOffset = c(-30, -30),
  stringsAsFactors = FALSE
)


json_data <- toJSON(coords, dataframe = "rows", auto_unbox = TRUE)

m <- leaflet(coords) %>%
  addProviderTiles(providers$Esri.WorldImagery) %>%
  fitBounds(
    lng1 = min(coords$lng), lat1 = min(coords$lat),
    lng2 = max(coords$lng), lat2 = max(coords$lat)
  )

for(i in seq_len(nrow(coords))) {
  m <- m %>%
    addMarkers(
      lng        = coords$lng[i], 
      lat        = coords$lat[i],
      layerId    = coords$label[i],
      label      = coords$label[i],
      labelOptions = labelOptions(
        noHide    = TRUE,
        direction = "top",
        offset    = c(coords$xOffset[i], coords$yOffset[i]),
        style     = list(
          "background"    = "white",
          "padding"       = "3px 6px",
          "border-radius" = "4px",
          "box-shadow"    = "0 0 2px rgba(0,0,0,0.5)"
        )
      )
    )
}

m %>% onRender(
  sprintf(
"function(el, x) {
   // parse our R data.frame as JS array of objects
   var data = %s;
   this.eachLayer(function(layer) {
     // only consider our markers (they all have layerId set)
     if(layer.options && layer.options.layerId) {
       // find matching record by label
       var rec = data.find(function(d){ return d.label === layer.options.layerId; });
       if(rec && rec.url) {
         layer.on('click', function() {
           window.open(rec.url, '_blank');
         });
       }
     }
   });
}", 
    json_data
  )
)
```

# Methodology {#sec-Methodology}
